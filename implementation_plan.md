# LyricSync AI 開発計画

この計画は、音源分離機能を中心とした LyricSync AI アプリケーションの開発手順をまとめたものです。

## ユーザーレビューが必要な事項
> [!NOTE]
> 提案されている技術スタックと機能の範囲をご確認ください。

## 提案される変更

### バックエンド (`backend/`)
- [x] **環境構築**: Python仮想環境と依存関係が正しく構成されているか確認します。
- [x] **API開発 (`main.py`)**:
    - FastAPIを使用してREST APIエンドポイントを実装します。
    - `POST /upload`: 音声ファイルのアップロード処理。
    - `POST /separate`: 音源分離の実行トリガー。
    - `GET /download/{filename}`: 処理された音声ファイルの提供。
- [x] **コアロジック (`audio_processor.py`)**:
    - 標準ライブラリまたは外部CLIツール（Demucs、Spleeterなど）を使用して、音声分離ロジックを実装します。
    - 入力および出力のファイルパスを管理します。

### フロントエンド (`frontend/`)
- [x] **初期セットアップ**: Vite + React + TypeScript の構成を確認します。
- [x] **UI実装**:
    - **ヘッダー**: アプリケーションのタイトル。
    - **アップロードコンポーネント**: ドラッグ＆ドロップまたはファイル選択エリア。
    - **処理インジケーター**: 分離処理中の視覚的なフィードバック。
    - **結果エリア**:
        - 「原曲」「ボーカル」「インストゥルメンタル」用のオーディオプレイヤー。
        - 各ステム（音源）のダウンロードボタン。
- [x] **API統合 (`src/lib/api.ts` など)**:
    - フロントエンドのコンポーネントをバックエンドのエンドポイントに接続します。

## 歌詞文字起こしフェーズ (Whisper)

### バックエンド
- [ ] **Whisper実装**:
    - `audio_processor.py`: `openai-whisper` を使用して、分離されたボーカル（`vocals.wav`）からテキストを抽出する関数を実装します。
- [ ] **API拡張**:
    - `main.py`: `/transcribe` エンドポイントを追加し、文字起こし処理をトリガーします。

### フロントエンド
- [ ] **結果表示UI**:
    - 文字起こしボタンを追加します。
    - 取得した歌詞テキストを表示するエリアを作成します。

## 検証計画

### 自動テスト
- [ ] バックエンド: APIエンドポイントの単体テスト（`pytest` + `TestClient` を使用）。

### 手動検証
1. **バックエンドの起動**: `uvicorn main:app --reload` を実行し、エラーなく起動することを確認します。
2. **フロントエンドの起動**: `npm run dev` を実行し、ブラウザを開きます。
3. **End-to-Endワークフロー**:
    - サンプル音声ファイル（`demo.mp3` または `demo.mp4`）をアップロードします。
    - 分離処理が開始され、完了することを確認します。
    - 生成された「ボーカル」および「インストゥルメンタル」トラックを再生します。
    - 分離されたファイルをダウンロードし、その内容を確認します。

## リファクタリング計画

### フロントエンド
1.  **型定義の共通化**: `App.tsx` に定義されている `UploadResult`, `Segment` などの型を `src/types.ts` に移動し、各コンポーネントで再利用可能にします。
2.  **コンポーネント抽出**: `App.tsx` 内にあるビデオプレーヤーと字幕オーバーレイ表示部分を `src/components/VideoPlayer.tsx` として分離します。これにより `App.tsx` の見通しを良くします。

### バックエンド
1.  **ロジックの分離**: `main.py` に記述されている `process_video` 関数や、ファイルパス操作ロジックを `backend/services.py` に移動します。
2.  **メインファイルの整理**: `main.py` はAPIエンドポイントの定義（コントローラー）に専念させ、ビジネスロジックへの依存度を下げます。

## UI改善: 2画面構成 (Split View) [Reverted]

> [!NOTE]
> ユーザーの要望により、元の縦並びレイアウトに戻しました。

### フロントエンド (`App.tsx`)
- [-] **レスポンシブ・ブレークポイントの変更**:
    - 現状の `lg:flex-row` (1024px以上) では、一部のノートPCなどで縦並びになってしまう可能性があります。
    - `md:flex-row` (768px以上) に変更し、より幅広い画面サイズで横並び（2画面構成）になるようにします。
- [-] **レイアウト比率の調整** (オプション):
    - 必要に応じて、エディタとプレビューの比率を調整します（現在はエディタ60%, プレビュー40%）。

### 検証計画
- [ ] (Reverted) Chrome DevToolsでウィンドウ幅を変更し、768px以上で横並びになることを確認します。
