# 企画書：ストリーミング文字起こしとUI改善案

## 1. 背景と課題
現在、Whisper `medium` モデルおよびボーカル分離処理（Demucs）の使用により、解析開始から結果表示までに数十秒から数分の待ち時間が発生している。
ユーザーが「処理が動いているか」を不安に感じやすく、また全体の完了を待たないと内容の確認や修正ができない点が UX 上の課題となっている。

## 2. コンセプト
**「待たせない文字起こし」**
AI が解析を完了したセグメント（歌詞の一行）から順次フロントエンドへ配信し、ユーザーがリアルタイムで進捗を確認・編集できるプロフェッショナルな操作感を実現する。

## 3. 主要機能案

### 3.1 逐次データ配信 (Backend: SSE / Streaming)
- **技術方式**: Server-Sent Events (SSE) または HTTP Streaming。
- **挙動**: サーバー側で解析が1セグメント完了するごとに、JSON 形式でフロントエンドへ即時送信する。
- **メリット**: 最初の解析結果が数秒以内に画面に現れるため、体感的な待ち時間を劇的に短縮できる。

### 3.2 ライブ・プロンプター UI (Frontend: Auto-Scroll)
- **自動追従スクロール**: 新しい歌詞が追加されるたびに、リストの最下部へスムーズにスクロールする。
- **スマート一時停止**: ユーザーが手動でスクロール（過去の行をチェック）している間は自動追従を停止し、作業を妨げない。
- **解析インジケーター**: リストの末尾に「AIが現在解析中のタイムライン」を表示し、躍動感を演出する。

### 3.3 リアルタイム・プレビュー連携
- 書き出しを待たずとも、生成されたばかりの字幕が即座にビデオプレーヤー上のオーバーレイに反映される。

## 4. 技術的な実装方針

### バックエンド (Python/FastAPI)
- `whisper` の解析ループからジェネレーターを作成。
- `fastapi.responses.StreamingResponse` を用いて、セグメント単位で `yield` する。

### フロントエンド (React/TypeScript)
- `fetch` の `body.getReader()` を使用してストリームを購読。
- 受信したデータを `segments` ステートに `append` し、`useEffect` でスクロール位置を制御する。

---
**作成日**: 2026年2月5日
**ステータス**: 提案・検討中
